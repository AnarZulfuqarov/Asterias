import "./index.scss";
import backBak from "../../../assets/Group42.png";
import icon from "../../../assets/icob2.png";
import xet from "../../../assets/Path (top).png";
import xet1 from "../../../assets/Path (bottom).png";
import xet2 from "../../../assets/Path (top1).png";
import { useNavigate, useParams } from "react-router-dom";
import { useTranslation } from "react-i18next";
import { useState } from "react";
import flagAz from "../../../assets/azerbaijan.png";
import flagEn from "../../../assets/uk.png";
import flagRu from "../../../assets/circle.png";
import { FaChevronDown } from "react-icons/fa";
import { useGetOffersByIdQuery } from "../../../services/userApi.jsx";
import {OFFER_IMAGES} from "../../../contants.js";

function ServDetailPageTwo() {
    const navigate = useNavigate();
    const { t, i18n } = useTranslation();
    const [langDropdownOpen, setLangDropdownOpen] = useState(false);
    const [langTimeoutId, setLangTimeoutId] = useState(null);
    const { id } = useParams();
    const { data: getOffersById, isLoading, error } = useGetOffersByIdQuery(id);
    const offer = getOffersById?.data;

    const toggleLangDropdown = () => {
        setLangDropdownOpen(!langDropdownOpen);
    };

    const handleLanguageChange = (lng) => {
        i18n.changeLanguage(lng);
        localStorage.setItem("asteriasLang", lng);
        setLangDropdownOpen(false);
    };

    let currentFlag = flagAz;
    let currentTitle = "Az";
    if (i18n.language?.startsWith("en")) {
        currentTitle = "En";
        currentFlag = flagEn;
    } else if (i18n.language?.startsWith("ru")) {
        currentTitle = "Ru";
        currentFlag = flagRu;
    } else if (i18n.language?.startsWith("az")) {
        currentTitle = "Az";
        currentFlag = flagAz;
    }

    const handleLangMouseEnter = () => {
        if (langTimeoutId) {
            clearTimeout(langTimeoutId);
            setLangTimeoutId(null);
        }
    };

    const handleLangMouseLeave = () => {
        const timeout = setTimeout(() => {
            setLangDropdownOpen(false);
        }, 1000);
        setLangTimeoutId(timeout);
    };

    if (isLoading) {
        return <div>Loading...</div>;
    }

    if (error || !offer) {
        return <div>Error loading offer details or offer not found.</div>;
    }

    // Determine the text based on the current language
    const offerName = i18n.language?.startsWith("en")
        ? offer.nameEng
        : i18n.language?.startsWith("ru")
            ? offer.nameRu
            : offer.name;
    const offerDescription = i18n.language?.startsWith("en")
        ? offer.descriptionEng
        : i18n.language?.startsWith("ru")
            ? offer.descriptionRu
            : offer.description;
    const offerPeriod = i18n.language?.startsWith("en")
        ? offer.periodEng
        : i18n.language?.startsWith("ru")
            ? offer.periodRu
            : offer.period;
    const offerAgeLimit = offer.ageLimit;

    // Construct image URLs for the offer, falling back to the default main image if needed
    const images = offer.offerImageNames?.length
        ? offer.offerImageNames.map((imageName) => `${imageName}`)
        : [main, main, main]; // Fallback to main image if offerImageNames is empty

    return (
        <div id={"servDetailTwo"}>
            <div className={"container"}>
                <div className={"back"} onClick={() => navigate("/")}>
                    <img src={backBak} alt="Back" />
                </div>
                <div className={"row"} style={{ alignItems: "start" }}>
                    <div className={"col-6 col-md-12 col-sm-12 col-xs-12"}>
                        <div className={"text"}>
                            <div className={"head"}>
                                <h2>
                                    <img src={icon} alt="Icon" /> {offerName}
                                </h2>
                            </div>
                            <p>{offerDescription}</p>
                            <div className={"functions"}>
                                <div
                                    className={"function1"}
                                    style={{
                                        width:
                                            i18n.language === "az"
                                                ? "224px"
                                                : i18n.language === "en"
                                                    ? "224px"
                                                    : "300px",
                                    }}
                                >
                                    <div className={"overlay"}></div>
                                    <div className={"content"}>
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="24"
                                            height="24"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                        >
                                            <path
                                                d="M6.8076 0C7.03038 0 7.24404 0.0884998 7.40157 0.24603C7.5591 0.403561 7.6476 0.617218 7.6476 0.84V2.4108H16.668V0.8508C16.668 0.628018 16.7565 0.414361 16.914 0.25683C17.0716 0.0992998 17.2852 0.0108 17.508 0.0108C17.7308 0.0108 17.9444 0.0992998 18.102 0.25683C18.2595 0.414361 18.348 0.628018 18.348 0.8508V2.4108H21.6C22.2363 2.4108 22.8466 2.66349 23.2966 3.11332C23.7467 3.56315 23.9997 4.17329 24 4.8096V21.6012C23.9997 22.2375 23.7467 22.8477 23.2966 23.2975C22.8466 23.7473 22.2363 24 21.6 24H2.4C1.76369 24 1.15342 23.7473 0.703368 23.2975C0.253315 22.8477 0.000318156 22.2375 0 21.6012L0 4.8096C0.000318156 4.17329 0.253315 3.56315 0.703368 3.11332C1.15342 2.66349 1.76369 2.4108 2.4 2.4108H5.9676V0.8388C5.96792 0.616226 6.05656 0.402877 6.21405 0.245606C6.37155 0.0883348 6.58503 -2.27116e-07 6.8076 0ZM1.68 9.2904V21.6012C1.68 21.6958 1.69862 21.7894 1.73481 21.8767C1.77099 21.9641 1.82403 22.0435 1.89088 22.1103C1.95774 22.1772 2.03711 22.2302 2.12447 22.2664C2.21182 22.3026 2.30545 22.3212 2.4 22.3212H21.6C21.6946 22.3212 21.7882 22.3026 21.8755 22.2664C21.9629 22.2302 22.0423 22.1772 22.1091 22.1103C22.176 22.0435 22.229 21.9641 22.2652 21.8767C22.3014 21.7894 22.32 21.6958 22.32 21.6012V9.3072L1.68 9.2904ZM8.0004 17.5428V19.542H6V17.5428H8.0004ZM12.9996 17.5428V19.542H11.0004V17.5428H12.9996ZM18 17.5428V19.542H15.9996V17.5428H18ZM8.0004 12.7704V14.7696H6V12.7704H8.0004ZM12.9996 12.7704V14.7696H11.0004V12.7704H12.9996ZM18 12.7704V14.7696H15.9996V12.7704H18ZM5.9676 4.0896H2.4C2.30545 4.0896 2.21182 4.10822 2.12447 4.14441C2.03711 4.18059 1.95774 4.23362 1.89088 4.30048C1.82403 4.36734 1.77099 4.44671 1.73481 4.53407C1.69862 4.62142 1.68 4.71505 1.68 4.8096V7.6116L22.32 7.6284V4.8096C22.32 4.71505 22.3014 4.62142 22.2652 4.53407C22.229 4.44671 22.176 4.36734 22.1091 4.30048C22.0423 4.23362 21.9629 4.18059 21.8755 4.14441C21.7882 4.10822 21.6946 4.0896 21.6 4.0896H18.348V5.2044C18.348 5.42718 18.2595 5.64084 18.102 5.79837C17.9444 5.9559 17.7308 6.0444 17.508 6.0444C17.2852 6.0444 17.0716 5.9559 16.914 5.79837C16.7565 5.64084 16.668 5.42718 16.668 5.2044V4.0896H7.6476V5.1936C7.6476 5.41638 7.5591 5.63004 7.40157 5.78757C7.24404 5.9451 7.03038 6.0336 6.8076 6.0336C6.58482 6.0336 6.37116 5.9451 6.21363 5.78757C6.0561 5.63004 5.9676 5.41638 5.9676 5.1936V4.0896Z"
                                                fill="#848484"
                                            />
                                        </svg>
                                        {t("servDetailTwo.functions.duration_label")} :
                                        <span>{offerPeriod}</span>
                                    </div>
                                </div>
                                <div className={"function2"}>
                                    <div className={"overlay"}></div>
                                    <div className={"content"}>
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="25"
                                            height="25"
                                            viewBox="0 0 25 25"
                                            fill="none"
                                        >
                                            <path
                                                d="M6 8.5C6 7.83696 6.26339 7.20107 6.73223 6.73223C7.20107 6.26339 7.83696 6 8.5 6C9.16304 6 9.79893 6.26339 10.2678 6.73223C10.7366 7.20107 11 7.83696 11 8.5C11 9.16304 10.7366 9.79893 10.2678 10.2678C9.79893 10.7366 9.16304 11 8.5 11C7.83696 11 7.20107 10.7366 6.73223 10.2678C6.26339 9.79893 6 9.16304 6 8.5ZM8.5 4.5C7.43913 4.5 6.42172 4.92143 5.67157 5.67157C4.92143 6.42172 4.5 7.43913 4.5 8.5C4.5 9.56087 4.92143 10.5783 5.67157 11.3284C6.42172 12.0786 7.43913 12.5 8.5 12.5C9.56087 12.5 10.5783 12.0786 11.3284 11.3284C12.0786 10.5783 12.5 9.56087 12.5 8.5C12.5 7.43913 12.0786 6.42172 11.3284 5.67157C10.5783 4.92143 9.56087 4.5 8.5 4.5ZM16 9.5C16 9.10218 16.158 8.72064 16.4393 8.43934C16.7206 8.15804 17.1022 8 17.5 8C17.8978 8 18.2794 8.15804 18.5607 8.43934C18.842 8.72064 19 9.10218 19 9.5C19 9.89782 18.842 10.2794 18.5607 10.5607C18.2794 10.842 17.8978 11 17.5 11C17.1022 11 16.7206 10.842 16.4393 10.5607C16.158 10.2794 16 9.89782 16 9.5ZM17.5 6.5C16.7044 6.5 15.9413 6.81607 15.3787 7.37868C14.8161 7.94129 14.5 8.70435 14.5 9.5C14.5 10.2956 14.8161 11.0587 15.3787 11.6213C15.9413 12.1839 16.7044 12.5 17.5 12.5C18.2956 12.5 19.0587 12.1839 19.6213 11.6213C20.1839 11.0587 20.5 10.2956 20.5 9.5C20.5 8.70435 20.1839 7.94129 19.6213 7.37868C19.0587 6.81607 18.2956 6.5 17.5 6.5ZM4.75 14.5C4.15326 14.5 3.58097 14.7371 3.15901 15.159C2.73705 15.581 2.5 16.1533 2.5 16.75V17.028C2.50105 17.0975 2.50572 17.167 2.514 17.236C2.59712 17.98 2.86453 18.6915 3.292 19.306C4.11 20.474 5.672 21.5 8.5 21.5C9.876 21.5 10.953 21.257 11.79 20.873C11.5109 20.4542 11.3009 19.9934 11.168 19.508C10.542 19.798 9.683 20 8.5 20C6.078 20 5.014 19.15 4.52 18.445C4.24041 18.0412 4.06425 17.5748 4.007 17.087L4 17.007V16.75C4 16.5511 4.07902 16.3603 4.21967 16.2197C4.36032 16.079 4.55109 16 4.75 16H11.566C11.8658 15.4455 12.2719 14.9555 12.761 14.558C12.5934 14.5196 12.422 14.5002 12.25 14.5H4.75ZM23 18.25C23 17.2554 22.6049 16.3016 21.9017 15.5983C21.1984 14.8951 20.2446 14.5 19.25 14.5L19.148 14.507C18.9598 14.5329 18.7883 14.6293 18.6684 14.7767C18.5485 14.9241 18.489 15.1115 18.502 15.3011C18.5149 15.4907 18.5994 15.6683 18.7382 15.798C18.8771 15.9278 19.06 15.9999 19.25 16L19.404 16.005C19.9868 16.0439 20.5317 16.3079 20.9233 16.7413C21.315 17.1746 21.5228 17.7433 21.5028 18.327C21.4828 18.9108 21.2366 19.4639 20.8162 19.8694C20.3958 20.275 19.8341 20.5011 19.25 20.5L19.247 20.505L19.145 20.512C18.9562 20.5379 18.7844 20.6348 18.6644 20.7828C18.5444 20.9309 18.4853 21.1191 18.499 21.3091C18.5128 21.4992 18.5984 21.6769 18.7384 21.8062C18.8784 21.9354 19.0624 22.0065 19.253 22.005V22L19.453 21.995C20.4111 21.9431 21.3128 21.5258 21.9726 20.8292C22.6325 20.1326 23.0001 19.2095 23 18.25ZM16.5 15.25C16.5 15.0511 16.421 14.8603 16.2803 14.7197C16.1397 14.579 15.9489 14.5 15.75 14.5L15.55 14.505C14.5729 14.5555 13.6543 14.9858 12.9901 15.7042C12.3259 16.4225 11.9687 17.372 11.9948 18.35C12.0209 19.3281 12.4282 20.2572 13.1298 20.9391C13.8313 21.621 14.7716 22.0017 15.75 22L15.852 21.993C16.0402 21.9671 16.2117 21.8707 16.3316 21.7233C16.4515 21.5759 16.511 21.3885 16.498 21.1989C16.4851 21.0093 16.4006 20.8317 16.2618 20.702C16.1229 20.5722 15.94 20.5001 15.75 20.5L15.596 20.495C15.0132 20.4561 14.4683 20.1921 14.0767 19.7587C13.685 19.3254 13.4772 18.7567 13.4972 18.173C13.5172 17.5892 13.7634 17.0361 14.1838 16.6306C14.6042 16.225 15.1659 15.9989 15.75 16L15.852 15.993C16.0316 15.9684 16.1961 15.8795 16.3152 15.7429C16.4344 15.6063 16.5 15.4312 16.5 15.25ZM20 18.25C20 18.0511 19.921 17.8603 19.7803 17.7197C19.6397 17.579 19.4489 17.5 19.25 17.5H15.75L15.648 17.507C15.4598 17.5329 15.2883 17.6293 15.1684 17.7767C15.0485 17.9241 14.989 18.1115 15.002 18.3011C15.0149 18.4907 15.0994 18.6683 15.2382 18.798C15.3771 18.9278 15.56 18.9999 15.75 19H19.25L19.352 18.993C19.5316 18.9684 19.6961 18.8795 19.8152 18.7429C19.9344 18.6063 20 18.4312 20 18.25Z"
                                                fill="#676767"
                                            />
                                        </svg>
                                        {t("servDetailTwo.functions.age_label")} :
                                        <span>{offerAgeLimit}</span>
                                    </div>
                                </div>
                            </div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="134" height="94" viewBox="0 0 134 94" fill="none"                                 className={"arrow"}
                            >
                                <path d="M1.3745 6.09042C2.78779 11.1104 4.86466 15.9964 7.55206 20.6234C9.21199 23.6066 11.1854 26.8576 13.392 30.2665C15.7345 33.9263 18.3235 37.4505 21.1403 40.8135C22.6631 42.6194 24.2985 44.3387 26.0358 45.9602C27.8205 47.6624 29.7455 49.2215 31.7877 50.6187C33.8654 52.072 36.0911 53.3 38.4182 54.2769C40.7576 55.2947 43.1988 56.0146 45.6748 56.4168L46.0853 56.4729C46.052 56.3393 45.9911 56.201 45.9472 56.0603C44.3176 50.7392 44.4864 45.2256 46.4283 40.3489C47.4421 37.8884 48.9902 35.7036 50.9783 33.9274C53.0593 32.0654 55.6587 30.7977 58.5285 30.2453C60.0277 29.9089 61.5976 29.8107 63.179 29.9544C64.9512 30.103 66.7054 30.6363 68.3083 31.5137C69.8461 32.4013 71.2033 33.5733 72.2913 34.9532C73.3792 36.3331 74.1734 37.8897 74.6218 39.5214C75.4327 42.4775 75.1627 45.51 73.8588 48.0915C72.6797 50.4635 70.9997 52.5407 68.9147 54.2044C66.8811 55.859 64.5608 57.1748 62.0358 58.1053C58.881 59.2596 55.4893 59.8665 52.0061 59.9001C52.3888 60.6002 52.8172 61.2796 53.2885 61.9339C56.0416 65.8107 59.6001 69.1352 63.7065 71.667C67.5213 74.0512 71.6334 75.9007 75.9031 77.1526C79.6277 78.2639 83.4344 78.9459 87.2387 79.1834C90.4691 79.3138 93.6758 79.164 96.8199 78.7357C101.751 78.1155 106.542 76.9683 111.106 75.3146C114.179 74.23 117.138 72.9136 119.958 71.3768C122.211 70.128 123.79 69.144 124.993 68.3494C126.05 67.6784 126.725 67.2063 127.266 66.8648L126.253 66.8308C123.365 66.7339 120.75 66.5998 118.541 66.4359C114.131 66.0986 111.308 65.6993 111.262 65.1965C111.216 64.6936 113.798 64.3059 118.1 64.0282C120.257 63.8798 122.82 63.7708 125.684 63.6984L126.769 63.6707C127.236 63.6539 127.707 63.6761 128.178 63.7369C128.48 63.7807 128.78 63.8494 129.075 63.9421C129.45 64.0594 129.812 64.2249 130.149 64.4338C130.844 64.8641 131.4 65.4834 131.736 66.2017C132.105 67.1359 132.295 68.1112 132.294 69.0767L132.485 71.3288C133.306 83.8157 133.188 93.8768 132.182 93.7642C131.175 93.6515 129.679 83.4402 128.847 70.9461L128.755 69.3019C128.303 69.8051 127.814 70.2756 127.29 70.7103C125.762 72.0402 124.118 73.2459 122.374 74.3169C119.524 76.1104 116.481 77.6302 113.284 78.8569C108.518 80.7334 103.482 82.0393 98.278 82.7476C94.8568 83.2271 91.3641 83.3928 87.8451 83.2426C83.6421 83.0033 79.4339 82.2598 75.3186 81.0296C70.5597 79.636 65.9788 77.5676 61.7357 74.8965C56.9943 71.9532 52.8963 68.0875 49.7433 63.5838C48.8295 62.2892 48.0459 60.9219 47.4044 59.5027C46.8492 59.4319 46.2941 59.3611 45.7477 59.2546C42.9753 58.7659 40.2467 57.9259 37.6353 56.7571C35.0996 55.6331 32.6797 54.241 30.4245 52.6088C28.2595 51.0695 26.2255 49.3576 24.3474 47.4943C22.5649 45.771 20.8917 43.9473 19.3388 42.0351C16.5217 38.5436 13.9569 34.8823 11.6652 31.0809C9.50613 27.5562 7.62604 24.2435 6.02497 21.143C3.45534 16.3555 1.60128 11.2993 0.522799 6.13789C0.256526 4.76732 0.0987464 3.38966 0.0508557 2.01707C0.0477717 1.08549 0.0589086 0.635216 0.150561 0.614049C0.242213 0.592882 0.477453 2.59731 1.39571 6.10478L1.3745 6.09042ZM50.1774 55.5679C50.2943 55.9662 50.4453 56.3597 50.5962 56.7533C53.9707 56.7563 57.2539 56.158 60.2809 54.9885C62.4887 54.1291 64.512 52.9356 66.2807 51.4494C68.0321 50.008 69.4336 48.218 70.4046 46.1822C71.3388 44.2535 71.507 42.0026 70.8802 39.8175C70.5854 38.7421 70.0631 37.7159 69.3473 36.8057C68.6316 35.8955 67.7385 35.1217 66.7262 34.5348C64.5856 33.535 62.2127 33.3027 60.0697 33.8833C57.8028 34.3498 55.7573 35.3812 54.1284 36.8793C52.5247 38.3794 51.2869 40.207 50.4892 42.2529C49.6749 44.3014 49.2313 46.4989 49.1762 48.758C49.1055 51.0217 49.4368 53.3192 50.1562 55.5536" fill="#595959"/>
                            </svg>
                            <button onClick={() => navigate("/contact")}>
                                {t("servDetailTwo.button")}
                            </button>
                        </div>
                    </div>
                    <div className={"col-6 col-md-12 col-sm-12 col-xs-12"}>
                        <div className={"images"}>
                            <div className={"image1"}>
                                <img src={OFFER_IMAGES + images[0]} alt={`${offerName} Image 1`} />
                            </div>
                            <div className={"image2"}>
                                <img src={OFFER_IMAGES + images[1] || images[0]} alt={`${offerName} Image 2`} />
                            </div>
                            <div className={"image3"}>
                                <img src={OFFER_IMAGES + images[2] || images[0]} alt={`${offerName} Image 3`} />
                            </div>
                            <div className={"image4"}>
                                <img src={xet} alt="Decorative Top Path" />
                            </div>
                            <div className={"image5"}>
                                <img src={xet1} alt="Decorative Bottom Path" />
                            </div>
                            <div className={"image6"}>
                                <img src={xet2} alt="Decorative Top Path 1" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div className="language">
                <div
                    className="dropdown"
                    onClick={toggleLangDropdown}
                    onMouseEnter={handleLangMouseEnter}
                    onMouseLeave={handleLangMouseLeave}
                >
                    <button
                        className="dropbtn"
                        style={{
                            cursor: "pointer",
                        }}
                    >
                        <img src={currentFlag} alt="Current Flag" />
                        {currentTitle}
                        <FaChevronDown className="zakirinChevronu" />
                    </button>
                    <div className={`dropdown-content ${langDropdownOpen ? "show" : ""}`}>
                        <div onClick={() => handleLanguageChange("az")}>
                            <img src={flagAz} alt="AZ Flag" /> {t("navbar.languages.az")}
                        </div>
                        <div onClick={() => handleLanguageChange("en")}>
                            <img src={flagEn} alt="EN Flag" /> {t("navbar.languages.en")}
                        </div>
                        <div onClick={() => handleLanguageChange("ru")}>
                            <img src={flagRu} alt="RU Flag" /> {t("navbar.languages.ru")}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
}

export default ServDetailPageTwo;